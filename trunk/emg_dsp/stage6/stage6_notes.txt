Hardware Fixes: 
	* The LEDs are TOO bright!  decrease the current to a more reasonable 
	level.  Current LEDs Vf = 2.0V :: 26mA of current. 10ma better -> 
	need 130 ohm resistors.
	Total power dissipation of 16 LEDs: 1.3W..?
	* Vdd_OTP NEEDS to be TIED TO 2.5V for the proc to boot.
	I guess I'll need a regulator here.
	(I assume this is needed by the security code)
	* Need caps on nordic lines to quench ringing (47pf, SCK & MOSI)
	* R61 & friends were not grounded (on the schematic) oops!
		Can jumper to R12.
	* The labels on the external power supply are SWAPPED! 
		28 is 0.8V, 08 is 2.8V! (or more accurately, 2.65V, as measured)
	

November 8 2010
	* Wrote a simplified .dxe - one that just toggles a few pins - 
	and the BF527 seems to run. Next: see if we can get the SPI interface running. 
	(this will show if the SPI pins are connected - the proc does not boot, 
	but this is likely because the flash originally ordered was a 2V part)
	* putting the SDRAM in self refresh works. 
	* setting the core clock at 600Mhz and the system clock at 125Mhz 
	seems to work as well. the toggle rate is 6.666Mhz now; was 1.5Mhz.
	(I'm sure glad JTAG works!!!)
	* looks like the SPI port is working! Not sure why it doesn't try to boot..
	* Next task: get the UART working. soo useful. done.
	* SDRAM: initalized.  works, checked!  yay!
	* Ethernet: need to have a milisecond counter running first, in an interrupt.
	* Ethernet: works.  DCHP and all!
November 9 2010
	* Next: get the radio working. Needs to be soldered there first! 
November 12 2010
	* okay, the bridge - at least in a debug build - seems to work. 
	The radio is very sensitive to timing / sequencing: notably, NRF_CE
	must be low while uploading the response (command) packet.  
	so be it.  
	* -O3 does not work, for whatever reason.  ??  just use -O or -O2.
	* if you put the headstage in oscillate mode, it still appears that there
	 are dropped packets. perhaps it is the client..?
	 the trace from UDP packets indicates that nothing is being dropped, 
	 and the o-scope similarly looks good. 
November 15 2010
	* I guess the next thing is to try out the new version of the headstage..
	does not seem to transmit packets reliably. electrical issue?
	tried hand-soldering all the pins again - from the outside, without removing
	the chip, and no difference. 
	perhaps in the future I should have protronics put both the RHA2116 and 
	nRF24L01+ on the board?  Seems I'm not too good at it .. :-/
November 16 2010
	* Tried the same fimware with the first build of the headstage on stage6. 
	Looks like exactly the same behavior... therefore, it's probably not 
	a hardware issue (if it were, then the two different builds would 
	probably have different behavior). 
	Is it possible that the problem is bad data? e.g. sending 0x0000 for all
	samples leads to corrupted packets? 
	Perhaps one of the RF components is bad / the incorrect value? 
		This would affect output power, presumably, and for the small distances
		that i'm testing the radio at, there is no difference wrt orientation. 
		If the power were iffy, then changing orientation would affect response.
	Seems unlikely to be the SPI bus - both BF532s boot properly (so far as I can tell)
	Power supply voltage?
		Changing the supply voltage to 2.5V from 3.3V changes nothing. 
		(below 2.5, the processor is in reset, properly so)
		It's unlikely that changing the core voltage from 1.2 to 0.8 will change
		anything but the proc power dissipation.  The BF532 is rated at that voltage.
	Note the old version of the headstage - stage5 - works reliably. 
	* I guess the appropriate thing to do now is to mess around with software, 
	see if we can delve into why it's unreliable. 
	Okay! radio_tst_bidi() transmits 8 packets reliably, but does not RX the resulting
	command packet.  Hence, it is a software thing .. let's see if transition to RX 
	is there ..?
	Is putting the radio in off mode (NOR_CONFIG 0) needed? 
		No. (prior RX mode .. but then again, it doesn't rx the packet.)
		No. (prior TX mode). 
	radio_tst_bidi() does not work on stage5!! IRQ is never asserted.
Novemeber 19 2010
	present version of neurorecord (262) works when compiled with -O
	and uploaded using JTAG to headstage. 
	serial port is somehow borked, which sucks -- speaking of which should
	have ran some lines out so we can get the headstage serial on the bridge
	port -- but not a serious issue. 
	present version of the code flashed to stage6 headstage works fine, actually
	**provided** that the USB endpoint is not connected. 
	The instant you enable the USB endpoint, reception of the status packet
	falters.  
	Looks like it only sends full status packets when it says so...
		and it does not seem to be claiming so.
	Even after you disable the USB endpoint / kill the client, packet reception
	is still flaky: not all command packets are recieved. (as indicated by the IRQ line)
	Restarting the radio resets this behavior to default-good. 
		(without resetting the bridge, which implies that it's the firmware on 
		the stage6 headstage)
	perhaps flush the fifos when switching states? 
	if you try to debug the headstage without a hardware reset, it fails. .. why?
	flushing the fifos when switching states does fix the behavior. 
	rather, it appears that every other RX packet is dropped, and the proc
	simply waits forever for it..
	turning on and off the pc-side client does not affect this behavior. 
	perhaps its a synchronization issue?  
		No, as its a flag that tells the bridge to send a command packet.
	** okay, with the mode switching, looks like all packets
	get through ... with high reliability. perhaps the problem is the flag is
	not being set.. ? 
	it doesn't look like the bridge is even trying to send a command packet.
	doesn't look like the packet format changed..
	ugh, not sure bout this
	if I put in a clear-fifo command before starting the transmit-only while 
	loop, it's more reliable but not completely so: bridge only gets 7 packets
	before deciding to transmit a status pkt. 
	seems like there is a systematic offset somewhere.. ?
	now looks like the first packet is not getting through. why?
		adding a bit of delay between uploading the packets seems not to matter.
		on the other hand, USB seems super reliable now.  huh.
		clearing the fifo and re-writing the configuration also doesn't matter.
	* okay, drastically simplified the data write - one packet at a time. 
		it works fine. very consistent. 
		of course, there is no memory writing going on. 
	* let's use sample() instead of spi waits. 
		YES that works.
	* try no memory writes in real prog.
		sorta works ... IRQ not getting cleared.
		fixed, added a fifo clearing. 
		now, data transmitted does not make sense!
		It is ''definitely'' the memory read / write. perhaps to the wrong loc? 
	* putting the RX mode back in there.  
		Of course it does not work - need to send out the packet special byte. 
		Now, bridge sees the special byte - and sends out a response - 
		but the headscage does not hear it? 
	* AHA!! the bridge does not have CRC ON!!! 
		It occurs to me that CRC should be on bigtime when writing mem
		but: not the other direction!! IMPORTANT
	* turning back on memory writes. there seems to be some systematic offset.
		wtf?
	* It seems that this hardware is somehow more 'fragile' - the pointers are 
	 more likely to go out of bounds or become desynchronized. 
	 not really sure why.. 
	 	Also: have a hard time programming the flash now.  more hardware gremlins?
	* Anyway, now looks like we're not getting to RX mode fast enough.
		Or, more accurately, still desyncronized. 
November 22 2010 --
	* Finally, got stage6 headstage werkin -- as the SVN log will attest, it *WAS*
	setup / hold violations.  HAve no idea why the C version does not work reliably, 
	but the ASM version does, and that is what matters. (neurorecord svn ver 265)
	* Now: ethernet client does not switch channels properly.  hum hum. 
		does switch with USB bridge, that packet dropping ho. 
November 30 2010 - back to work after a wonderful thanksgiving holiday. 
	Everything is basically working, as expected. 
	* Issue: client needs to be told the IP address of the bridge. is this reasonable?
		Yes, I guess.  In the future there will likely be more than one headstage, 
		more than one bridge. 
	* Issue: no Intan chips on the headstage.  I guess I should install them? 
		Assuming that I can?  or gear up for producing more headstages?
		Probably best to test this wireless headstage in a mk, asap.
	* Omnetics connector FAIL.  Fell off while I was inserting the jumper to the 
		headstage test board; these must be mounted properly the first time
		(they tend to warp during reflow), then glued to the board.
	* Thresholding is not working either. check the code. seems to be off by one bit:
		Looks like seeting gain high on channel 0 yields threshold of 0x3 (0b0011)
		setting gain high on channel 1 yields threshold of 0xc (0b1100)
		channel 2, 0x30. 
		This is the same on stage5, as expected. 
		Everything seems multiplied by 2...?
		Try channel 16, 0x2 
		channel 17, 0x8
		Perhaps this is a strange consequence of how VIT_MAX works? 
		aha!  "The accumulator register must be cleared before issuing VIT_MAX"
		Indeed, it does. 
	* Issue: seems to detect both positive and negative excursions.  Is this desired?
		(otherwise, seems to be working)
Novemeber 31 2010 -
	* Should have a disable-filter mode on the headstage, too. 
		Done. Works as expected. 
	* Using the flat-filter mode, threshold is definitely bidirectional - abs. 
		Fixed.  VIT_MAX instruction only has 15 bits of dynamic range - so we simply 
		divide both samples by 2 (>>> 1 (v) instruction). 
		and divide the threshold by 2 prior transmission.
	* Next up: work on the client program: 
		+ need to save to disc and visualize spikes. (threshold crossings)
		+ need to be able to invert gain. (that should be easy)
		+ make the gui more reliable - raw x events is not cutting it! 
December 2 2010 -
	* Decided to move to gtk2.0 as a gui toolkit for the client. The simple X protocol
		was not cutting it!   Now, have to migrate...
December 13 2010 -
	* gtk2 gui mostly done, functional though there is still a segfault bug somewhere..
	* want to measure current consumption of the core, and try to optimize.
		Headstage is by default running at 240Mhz @ 1.2V (same as BF527)
		Step signal is on PF8 -- looks like max codepath is 528ns, so it is 
		almost possible to knock the clock down to 120Mhz.
		Is this long codepath dependent on RXing a packet? 
		No, with the bridge off, still get it.
		I could simplify the filtering perhaps... hm. 
	* CLI/IDLE/STI seems to take about 180ns. 
		make little sense to do this; might as well keep it in a software loop.
	* Power figures, 
		CCLK 160Mhz SCLK 80Mhz: 
		Proc runs & boots at 0.7v.
		static current at 1V about 7ma.
		0.630v ; 19.42ma ; non-operating.
		0.641v ; 28.49ma ; 18.26mw
		0.668v ; 29.70ma ; 19.83mw
		0.708v ; 31.98ma ; 22.64mw
		0.739v ; 33.56ma ; 24.80mw
		0.793v ; 36.78ma ; 29.17mw
		0.806v ; 37.42ma ; 30.12mw
		0.849v ; 40.08ma ; 34.03mw
		0.944v ; 46.24ma ; 43.65mw
		0.997v ; 49.39ma ; 49.24mw
		1.087v ; 55.41ma ; 60.23mw
		CCLK 80Mhz SCLK 40Mhz
		0.622v ; 12.20ma ; non-operating
		0.649v ; 16.17ma ; 10.49mw
		0.705v ; 18.04ma ; 12.72mw
		0.752v ; 19.60ma ; 14.74mw
		0.804v ; 21.51ma ; 17.29mw
		0.857v ; 23.51ma ; 20.16mw
		0.908v ; 25.52ma ; 23.17mw
		0.951v ; 27.28ma ; 25.94mw
	* Possible clocking schemes. 
		160Mhz (x10) - CCLK 80Mhz - cpu ultilization about 60%
			2.830V ; 8.81ma ; 24.93mw
			0.813v ; 33.66ma ; 27.36mw
			proc operating at  at the same time.
			proc stopped: 2.23ma
			total power, excl intans: 52.29mw ; 69.59mw w/
			Intans: 7mw from 3.0v supply, 17.3mw from battery
			(operating from 2.8V supply will save 4mw -- not worth it --
				only adds 3 hours to the optimized figure)
		80Mhz (x5) - CCLK 40Mhz - must disable oversampling, every read
			sample counts.  both ADCs run at 10Mhz / 500ksps.
			2.800v ; 6.65ma ; 18.7mw
			0.813v ; 21.09ma ; 17.14mw
			have the extra cycles for this, at least..
			total power, excl. intans: 35.85mw ; 53.15 w/
	* Have: cell phone battery, rated 800mAH, 3.6v -> 2880mwH
		consumed at 69.6mw, this will last 41 hours. (full x2 oversampling)
		consumed at 54.2mw, this will last 54 hours.
		of course, probably want to run multiple headstages.
		Assuming we are running 4 headstages and we want them to last 30 hours, 
		need a 6.5wh battery, or 1800mah.  This should be possible - cell batteries 
		can be had in 2200mah size.
		2200mah will run 6 headstages for a full day, about (excluding conversion efi)
December 16 2010 -- got the headstage working (apparently) properly @ 80Mhz. 
	Can save a bit of power at this rate (8mw proc, 6mw ADCs). 
	So far as I can tell, we don't need the oversampling; the fidelity is
	limited by the fidelity of the input from the electrodes. 
	The problem was clocking the SPI port too low (5Mhz); this seems to have
	cause alignment error when reading packets RXed from the bridge. 
	Also changed the bridge to reset the RX fifo when sending packets over
	ethernet. Appears to have made everything more reliable. 
	* Need to indicate when the gain is saturated.  Seem to occur relatively soonish. 
December 17 2010 -- The headstage has been separated!  It consumes:
	15.0ma @ 4.18v = 62.7mw